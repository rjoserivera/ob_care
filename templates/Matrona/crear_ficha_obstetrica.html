{% extends 'Shared/base.html' %}
{% load static %}

{% block title %}Crear Ficha Obstétrica{% endblock %}

{% block extra_css %}
<style>
    .ficha-container {
        max-width: 1000px;
        margin: 2rem auto;
    }

    .ficha-header {
        background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
        color: white;
        padding: 2rem;
        border-radius: 15px;
        margin-bottom: 2rem;
    }

    .ficha-header h2 {
        margin-bottom: 0.5rem;
    }

    .persona-info-card {
        background: white;
        border-radius: 15px;
        padding: 2rem;
        margin-bottom: 2rem;
        box-shadow: 0 5px 20px rgba(0,0,0,0.08);
        border-left: 5px solid #11998e;
    }

    .persona-info-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 1.5rem;
    }

    .info-item {
        padding: 1rem;
        background: #f8f9fa;
        border-radius: 8px;
    }

    .info-label {
        font-size: 0.85rem;
        color: #666;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        margin-bottom: 0.3rem;
    }

    .info-value {
        font-size: 1.1rem;
        color: #333;
        font-weight: 500;
    }

    .ficha-form {
        background: white;
        border-radius: 15px;
        padding: 2rem;
        box-shadow: 0 5px 20px rgba(0,0,0,0.08);
    }

    .form-section {
        margin-bottom: 2rem;
    }

    .section-title {
        font-size: 1.2rem;
        font-weight: 600;
        color: #333;
        padding-bottom: 1rem;
        border-bottom: 2px solid #11998e;
        margin-bottom: 1.5rem;
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }

    .section-title i {
        color: #11998e;
    }

    .form-row {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 1.5rem;
        margin-bottom: 1.5rem;
    }

    .form-group {
        display: flex;
        flex-direction: column;
    }

    .form-label {
        font-weight: 600;
        color: #333;
        margin-bottom: 0.5rem;
        font-size: 0.95rem;
    }

    .form-control, .form-select {
        padding: 0.75rem;
        border: 2px solid #e0e0e0;
        border-radius: 8px;
        font-size: 1rem;
        transition: all 0.3s ease;
        font-family: inherit;
    }

    .form-control:focus, .form-select:focus {
        border-color: #11998e;
        outline: none;
        box-shadow: 0 0 0 3px rgba(17, 153, 142, 0.1);
    }

    .form-text {
        font-size: 0.85rem;
        color: #666;
        margin-top: 0.3rem;
    }

    .required {
        color: #dc3545;
    }

    .checkbox-group {
        display: flex;
        align-items: center;
        gap: 1rem;
        flex-wrap: wrap;
        margin-bottom: 1rem;
    }

    .form-check {
        display: flex;
        align-items: center;
    }

    .form-check-input {
        width: 1.2rem;
        height: 1.2rem;
        cursor: pointer;
        border: 2px solid #e0e0e0;
        border-radius: 4px;
    }

    .form-check-input:checked {
        background-color: #11998e;
        border-color: #11998e;
    }

    .form-check-label {
        margin-left: 0.5rem;
        cursor: pointer;
        margin-bottom: 0;
        color: #333;
    }

    .button-group {
        display: flex;
        gap: 1rem;
        margin-top: 2rem;
        justify-content: center;
        flex-wrap: wrap;
    }

    .btn {
        padding: 0.75rem 2rem;
        border-radius: 8px;
        font-weight: 600;
        border: none;
        cursor: pointer;
        text-decoration: none;
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
        transition: all 0.3s ease;
    }

    .btn-primary {
        background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
        color: white;
    }

    .btn-primary:hover {
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(17, 153, 142, 0.3);
        color: white;
    }

    .btn-secondary {
        background: #e9ecef;
        color: #333;
    }

    .btn-secondary:hover {
        background: #dee2e6;
        color: #333;
        text-decoration: none;
    }

    .alert {
        padding: 1rem;
        border-radius: 8px;
        margin-bottom: 1.5rem;
        border-left: 4px solid;
    }

    .alert-info {
        background: #d1ecf1;
        color: #0c5460;
        border-color: #bee5eb;
    }

    .note-box {
        background: #fff3cd;
        border-left: 4px solid #ffc107;
        padding: 1rem;
        border-radius: 8px;
        margin-bottom: 1.5rem;
        color: #856404;
    }

    .breadcrumb {
        background: transparent;
        padding: 0;
        margin-bottom: 2rem;
    }

    .breadcrumb-item {
        color: #11998e;
    }

    .breadcrumb-item.active {
        color: #666;
    }

    @media (max-width: 768px) {
        .ficha-container {
            margin: 1rem;
        }

        .persona-info-grid {
            grid-template-columns: 1fr;
        }

        .form-row {
            grid-template-columns: 1fr;
        }

        .button-group {
            flex-direction: column;
        }

        .btn {
            width: 100%;
            justify-content: center;
        }
    }
</style>
{% endblock %}

{% block content %}
<div class="ficha-container">
    <!-- Breadcrumb -->
    <nav aria-label="breadcrumb">
        <ol class="breadcrumb">
            <li class="breadcrumb-item"><a href="{% url 'home' %}">Inicio</a></li>
            <li class="breadcrumb-item"><a href="{% url 'matrona:menu_matrona' %}">Matrona</a></li>
            <li class="breadcrumb-item active">Crear Ficha Obstétrica</li>
        </ol>
    </nav>

    <!-- Header -->
    <div class="ficha-header">
        <h2><i class="bi bi-file-earmark-medical"></i> {{ titulo }}</h2>
        <p>Complete los datos de la ficha obstétrica</p>
    </div>

    <!-- INFORMACIÓN DE PERSONA PRE-CARGADA -->
    {% if persona %}
    <div class="persona-info-card">
        <h3 style="margin-bottom: 1.5rem; color: #333;">
            <i class="bi bi-person-check-fill"></i> Información de la Persona
        </h3>

        <div class="persona-info-grid">
            <div class="info-item">
                <div class="info-label">Nombre Completo</div>
                <div class="info-value">{{ persona.Nombre }} {{ persona.Apellido_Paterno }} {{ persona.Apellido_Materno }}</div>
            </div>

            <div class="info-item">
                <div class="info-label">RUT</div>
                <div class="info-value">{{ persona.Rut }}</div>
            </div>

            <div class="info-item">
                <div class="info-label">Edad</div>
                <div class="info-value">
                    {% now "Y" as current_year %}
                    {{ current_year|add:persona.Fecha_nacimiento.year|add:"-1" }} años
                </div>
            </div>

            <div class="info-item">
                <div class="info-label">Fecha de Nacimiento</div>
                <div class="info-value">{{ persona.Fecha_nacimiento|date:"d/m/Y" }}</div>
            </div>

            <div class="info-item">
                <div class="info-label">Teléfono</div>
                <div class="info-value">{{ persona.Telefono|default:"No registrado" }}</div>
            </div>

            <div class="info-item">
                <div class="info-label">Dirección</div>
                <div class="info-value">{{ persona.Direccion|default:"No registrada" }}</div>
            </div>
        </div>

        <div style="margin-top: 1rem; text-align: right;">
            <a href="{% url 'gestion:editar_persona' persona.pk %}" style="color: #11998e; font-size: 0.9rem;">
                <i class="bi bi-pencil-square"></i> Editar datos de la persona
            </a>
        </div>
    </div>
    {% else %}
    <div class="alert alert-info">
        <i class="bi bi-info-circle"></i> No se ha seleccionado una persona. 
        <a href="{% url 'matrona:seleccionar_persona_ficha' %}">Volver a seleccionar</a>
    </div>
    {% endif %}

    <!-- FORMULARIO DE FICHA OBSTÉTRICA -->
    {% if persona %}
    <div class="ficha-form">
        <div class="alert alert-info">
            <i class="bi bi-info-circle"></i> 
            <strong>Nota:</strong> Los datos de la persona están pre-cargados arriba. 
            Completa esta ficha con la información obstétrica correspondiente.
        </div>

        <form method="post" novalidate>
            {% csrf_token %}

            <!-- SECCIÓN 1: DATOS INICIALES -->
            <div class="form-section">
                <div class="section-title">
                    <i class="bi bi-calendar-check"></i> Datos Iniciales
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">
                            Fecha de Ingreso <span class="required">*</span>
                        </label>
                        <input type="date" class="form-control" name="fecha_ingreso" required>
                    </div>

                    <div class="form-group">
                        <label class="form-label">
                            Hora de Ingreso <span class="required">*</span>
                        </label>
                        <input type="time" class="form-control" name="hora_ingreso" required>
                    </div>

                    <div class="form-group">
                        <label class="form-label">
                            Estado Civil
                        </label>
                        <select class="form-select" name="estado_civil">
                            <option value="">-- Seleccione --</option>
                            <option value="soltero">Soltera</option>
                            <option value="casado">Casada</option>
                            <option value="convivencia">En Convivencia</option>
                            <option value="viudo">Viuda</option>
                            <option value="separado">Separada</option>
                            <option value="divorciado">Divorciada</option>
                        </select>
                    </div>
                </div>
            </div>

            <!-- SECCIÓN 2: INFORMACIÓN OBSTÉTRICA -->
            <div class="form-section">
                <div class="section-title">
                    <i class="bi bi-heart-pulse-fill"></i> Información Obstétrica
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">
                            Paridad (Número de Partos) <span class="required">*</span>
                        </label>
                        <input type="number" class="form-control" name="paridad" min="0" required>
                        <span class="form-text">Cantidad de embarazos llevados a término</span>
                    </div>

                    <div class="form-group">
                        <label class="form-label">
                            Gestaciones <span class="required">*</span>
                        </label>
                        <input type="number" class="form-control" name="gestaciones" min="1" required>
                        <span class="form-text">Incluye embarazos actuales y anteriores</span>
                    </div>

                    <div class="form-group">
                        <label class="form-label">
                            Semanas de Gestación <span class="required">*</span>
                        </label>
                        <input type="number" class="form-control" name="semanas_gestacion" min="0" max="42" required>
                        <span class="form-text">Semanas de embarazo</span>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">
                            Fecha Última Menstruación (FUM)
                        </label>
                        <input type="date" class="form-control" name="fum">
                    </div>

                    <div class="form-group">
                        <label class="form-label">
                            Fecha Probable de Parto (FPP)
                        </label>
                        <input type="date" class="form-control" name="fpp">
                    </div>
                </div>
            </div>

            <!-- SECCIÓN 3: ANTECEDENTES -->
            <div class="form-section">
                <div class="section-title">
                    <i class="bi bi-file-text"></i> Antecedentes Médicos
                </div>

                <div class="form-group">
                    <label class="form-label">Alergias Conocidas</label>
                    <textarea class="form-control" name="alergias" rows="2" placeholder="Describa las alergias si las hay"></textarea>
                </div>

                <div class="form-group">
                    <label class="form-label">Antecedentes Quirúrgicos</label>
                    <textarea class="form-control" name="antecedentes_quirurgicos" rows="2" placeholder="Cirugías previas"></textarea>
                </div>

                <div class="form-group">
                    <label class="form-label">Patologías Crónicas</label>
                    <textarea class="form-control" name="patologias_cronicas" rows="2" placeholder="Diabetes, hipertensión, etc."></textarea>
                </div>
            </div>

            <!-- SECCIÓN 4: CONTROL PRENATAL -->
            <div class="form-section">
                <div class="section-title">
                    <i class="bi bi-clipboard-check"></i> Control Prenatal
                </div>

                <div class="checkbox-group">
                    <div class="form-check">
                        <input type="checkbox" id="control_prenatal" name="control_prenatal" class="form-check-input">
                        <label class="form-check-label" for="control_prenatal">
                            ¿Ha realizado control prenatal?
                        </label>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Número de Controles</label>
                        <input type="number" class="form-control" name="num_controles" min="0">
                    </div>

                    <div class="form-group">
                        <label class="form-label">Consultorio/Centro</label>
                        <input type="text" class="form-control" name="consultorio" placeholder="Nombre del lugar">
                    </div>
                </div>
            </div>

            <!-- BOTONES -->
            <div class="button-group">
                <button type="submit" class="btn btn-primary">
                    <i class="bi bi-check-circle"></i> Crear Ficha
                </button>

                <a href="{% url 'matrona:seleccionar_persona_ficha' %}" class="btn btn-secondary">
                    <i class="bi bi-arrow-left"></i> Cancelar
                </a>
            </div>
        </form>
    </div>
    {% endif %}
</div>
{% endblock %}
