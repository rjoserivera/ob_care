{% extends 'base.html' %}
{% load static %}

{% block title %}Registro TENS - Signos Vitales{% endblock %}

{% block extra_css %}
<style>
    .card-header {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        font-weight: 600;
    }
    
    .vital-card {
        border-left: 4px solid #667eea;
        transition: all 0.3s;
    }
    
    .vital-card:hover {
        box-shadow: 0 5px 15px rgba(0,0,0,0.1);
    }
    
    .alert-info-custom {
        background-color: #e3f2fd;
        border-left: 4px solid #2196f3;
        padding: 15px;
    }
    
    .form-check-input:checked {
        background-color: #667eea;
        border-color: #667eea;
    }
    
    .required-field::after {
        content: " *";
        color: #dc3545;
    }
    
    .vital-icon {
        font-size: 2rem;
        color: #667eea;
    }
</style>
{% endblock %}

{% block content %}
<div class="container-fluid mt-4">
    <div class="row justify-content-center">
        <div class="col-lg-10">
            
            <!-- Encabezado -->
            <div class="d-flex justify-content-between align-items-center mb-4">
                <div>
                    <h2>
                        <i class="bi bi-heart-pulse-fill text-primary"></i>
                        Registro TENS - Signos Vitales
                    </h2>
                    <p class="text-muted mb-0">Control de signos vitales de la paciente</p>
                </div>
                <a href="#" class="btn btn-outline-secondary">
                    <i class="bi bi-arrow-left"></i> Volver
                </a>
            </div>

            <!-- Formulario Principal -->
            <form method="post" novalidate>
                {% csrf_token %}
                
                <!-- Errores Generales -->
                {% if form.non_field_errors %}
                <div class="alert alert-danger alert-dismissible fade show" role="alert">
                    <i class="bi bi-exclamation-triangle-fill"></i>
                    <strong>Error:</strong>
                    {{ form.non_field_errors }}
                    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                </div>
                {% endif %}

                <!-- SECCIÓN 1: INFORMACIÓN DEL REGISTRO -->
                <div class="card mb-4 shadow-sm">
                    <div class="card-header">
                        <h5 class="mb-0">
                            <i class="bi bi-info-circle"></i> Información del Registro
                        </h5>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <!-- Ficha -->
                            <div class="col-md-4 mb-3">
                                <label for="{{ form.ficha.id_for_label }}" class="form-label required-field">
                                    {{ form.ficha.label }}
                                </label>
                                {{ form.ficha }}
                                {% if form.ficha.errors %}
                                    <div class="text-danger small mt-1">{{ form.ficha.errors }}</div>
                                {% endif %}
                            </div>

                            <!-- TENS Responsable -->
                            <div class="col-md-4 mb-3">
                                <label for="{{ form.tens_responsable.id_for_label }}" class="form-label required-field">
                                    {{ form.tens_responsable.label }}
                                </label>
                                {{ form.tens_responsable }}
                                {% if form.tens_responsable.errors %}
                                    <div class="text-danger small mt-1">{{ form.tens_responsable.errors }}</div>
                                {% endif %}
                            </div>

                            <!-- Fecha -->
                            <div class="col-md-4 mb-3">
                                <label for="{{ form.fecha.id_for_label }}" class="form-label required-field">
                                    {{ form.fecha.label }}
                                </label>
                                {{ form.fecha }}
                                {% if form.fecha.errors %}
                                    <div class="text-danger small mt-1">{{ form.fecha.errors }}</div>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                </div>

                <!-- SECCIÓN 2: SIGNOS VITALES -->
                <div class="card mb-4 shadow-sm">
                    <div class="card-header">
                        <h5 class="mb-0">
                            <i class="bi bi-activity"></i> Signos Vitales
                        </h5>
                    </div>
                    <div class="card-body">
                        
                        <div class="row">
                            <!-- Temperatura -->
                            <div class="col-md-6 mb-4">
                                <div class="vital-card card h-100">
                                    <div class="card-body">
                                        <div class="d-flex align-items-center mb-2">
                                            <i class="bi bi-thermometer-half vital-icon me-3"></i>
                                            <div class="flex-grow-1">
                                                <label for="{{ form.temperatura.id_for_label }}" class="form-label mb-0">
                                                    {{ form.temperatura.label }}
                                                </label>
                                            </div>
                                        </div>
                                        <div class="input-group">
                                            {{ form.temperatura }}
                                            <span class="input-group-text">°C</span>
                                        </div>
                                        {% if form.temperatura.errors %}
                                            <div class="text-danger small mt-1">{{ form.temperatura.errors }}</div>
                                        {% endif %}
                                        {% if form.temperatura.help_text %}
                                            <small class="form-text text-muted">{{ form.temperatura.help_text }}</small>
                                        {% endif %}
                                    </div>
                                </div>
                            </div>

                            <!-- Frecuencia Cardíaca -->
                            <div class="col-md-6 mb-4">
                                <div class="vital-card card h-100">
                                    <div class="card-body">
                                        <div class="d-flex align-items-center mb-2">
                                            <i class="bi bi-heart-pulse vital-icon me-3"></i>
                                            <div class="flex-grow-1">
                                                <label for="{{ form.frecuencia_cardiaca.id_for_label }}" class="form-label mb-0">
                                                    {{ form.frecuencia_cardiaca.label }}
                                                </label>
                                            </div>
                                        </div>
                                        <div class="input-group">
                                            {{ form.frecuencia_cardiaca }}
                                            <span class="input-group-text">lpm</span>
                                        </div>
                                        {% if form.frecuencia_cardiaca.errors %}
                                            <div class="text-danger small mt-1">{{ form.frecuencia_cardiaca.errors }}</div>
                                        {% endif %}
                                        {% if form.frecuencia_cardiaca.help_text %}
                                            <small class="form-text text-muted">{{ form.frecuencia_cardiaca.help_text }}</small>
                                        {% endif %}
                                    </div>
                                </div>
                            </div>

                            <!-- Presión Arterial -->
                            <div class="col-md-6 mb-4">
                                <div class="vital-card card h-100">
                                    <div class="card-body">
                                        <div class="d-flex align-items-center mb-2">
                                            <i class="bi bi-heart vital-icon me-3"></i>
                                            <h6 class="mb-0">Presión Arterial</h6>
                                        </div>
                                        <div class="row">
                                            <div class="col-6">
                                                <label for="{{ form.presion_arterial_sistolica.id_for_label }}" class="form-label small">
                                                    Sistólica
                                                </label>
                                                <div class="input-group">
                                                    {{ form.presion_arterial_sistolica }}
                                                    <span class="input-group-text">mmHg</span>
                                                </div>
                                                {% if form.presion_arterial_sistolica.errors %}
                                                    <div class="text-danger small mt-1">{{ form.presion_arterial_sistolica.errors }}</div>
                                                {% endif %}
                                            </div>
                                            <div class="col-6">
                                                <label for="{{ form.presion_arterial_diastolica.id_for_label }}" class="form-label small">
                                                    Diastólica
                                                </label>
                                                <div class="input-group">
                                                    {{ form.presion_arterial_diastolica }}
                                                    <span class="input-group-text">mmHg</span>
                                                </div>
                                                {% if form.presion_arterial_diastolica.errors %}
                                                    <div class="text-danger small mt-1">{{ form.presion_arterial_diastolica.errors }}</div>
                                                {% endif %}
                                            </div>
                                        </div>
                                        <small class="form-text text-muted">Formato: 120/80 mmHg</small>
                                    </div>
                                </div>
                            </div>

                            <!-- Frecuencia Respiratoria -->
                            <div class="col-md-6 mb-4">
                                <div class="vital-card card h-100">
                                    <div class="card-body">
                                        <div class="d-flex align-items-center mb-2">
                                            <i class="bi bi-lungs vital-icon me-3"></i>
                                            <div class="flex-grow-1">
                                                <label for="{{ form.frecuencia_respiratoria.id_for_label }}" class="form-label mb-0">
                                                    {{ form.frecuencia_respiratoria.label }}
                                                </label>
                                            </div>
                                        </div>
                                        <div class="input-group">
                                            {{ form.frecuencia_respiratoria }}
                                            <span class="input-group-text">rpm</span>
                                        </div>
                                        {% if form.frecuencia_respiratoria.errors %}
                                            <div class="text-danger small mt-1">{{ form.frecuencia_respiratoria.errors }}</div>
                                        {% endif %}
                                        {% if form.frecuencia_respiratoria.help_text %}
                                            <small class="form-text text-muted">{{ form.frecuencia_respiratoria.help_text }}</small>
                                        {% endif %}
                                    </div>
                                </div>
                            </div>

                            <!-- Saturación de Oxígeno -->
                            <div class="col-md-12 mb-4">
                                <div class="vital-card card h-100">
                                    <div class="card-body">
                                        <div class="d-flex align-items-center mb-2">
                                            <i class="bi bi-droplet-fill vital-icon me-3"></i>
                                            <div class="flex-grow-1">
                                                <label for="{{ form.saturacion_oxigeno.id_for_label }}" class="form-label mb-0">
                                                    {{ form.saturacion_oxigeno.label }}
                                                </label>
                                            </div>
                                        </div>
                                        <div class="input-group" style="max-width: 300px;">
                                            {{ form.saturacion_oxigeno }}
                                            <span class="input-group-text">%</span>
                                        </div>
                                        {% if form.saturacion_oxigeno.errors %}
                                            <div class="text-danger small mt-1">{{ form.saturacion_oxigeno.errors }}</div>
                                        {% endif %}
                                        {% if form.saturacion_oxigeno.help_text %}
                                            <small class="form-text text-muted">{{ form.saturacion_oxigeno.help_text }}</small>
                                        {% endif %}
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- SECCIÓN 3: OBSERVACIONES -->
                <div class="card mb-4 shadow-sm">
                    <div class="card-header">
                        <h5 class="mb-0">
                            <i class="bi bi-journal-text"></i> Observaciones
                        </h5>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-12 mb-3">
                                <label for="{{ form.observaciones.id_for_label }}" class="form-label">
                                    {{ form.observaciones.label }}
                                </label>
                                {{ form.observaciones }}
                                {% if form.observaciones.errors %}
                                    <div class="text-danger small mt-1">{{ form.observaciones.errors }}</div>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Botones de Acción -->
                <div class="card shadow-sm">
                    <div class="card-body">
                        <div class="d-flex justify-content-between">
                            <a href="#" class="btn btn-secondary">
                                <i class="bi bi-x-circle"></i> Cancelar
                            </a>
                            <button type="submit" class="btn btn-primary">
                                <i class="bi bi-save"></i> Guardar Registro
                            </button>
                        </div>
                    </div>
                </div>
            </form>

        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    console.log('✅ Formulario de Registro TENS cargado');
    
    // Validación de presión arterial en tiempo real
    const sistolica = document.querySelector('#{{ form.presion_arterial_sistolica.id_for_label }}');
    const diastolica = document.querySelector('#{{ form.presion_arterial_diastolica.id_for_label }}');
    
    if (sistolica && diastolica) {
        function validarPresion() {
            const valSis = parseInt(sistolica.value);
            const valDia = parseInt(diastolica.value);
            
            if (valSis && valDia) {
                if (valSis <= valDia) {
                    sistolica.classList.add('is-invalid');
                    diastolica.classList.add('is-invalid');
                } else {
                    sistolica.classList.remove('is-invalid');
                    diastolica.classList.remove('is-invalid');
                }
            }
        }
        
        sistolica.addEventListener('change', validarPresion);
        diastolica.addEventListener('change', validarPresion);
    }
});
</script>
{% endblock %}
